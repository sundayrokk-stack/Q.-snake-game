<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Snake - Retro Edition</title>
    <style>
        :root {
            --neon-green: #39FF14;
            --neon-red: #FF3131;
            --bg-color: #0a0a0a;
        }

        body {
            background-color: var(--bg-color);
            color: white;
            font-family: 'Courier New', Courier, monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            overflow: hidden;
            touch-action: manipulation;
        }

        #game-container {
            position: relative;
            margin-top: 20px;
        }

        canvas {
            border: 4px solid #333;
            box-shadow: 0 0 20px rgba(57, 255, 20, 0.2);
            background-color: black;
        }

        #ui {
            text-align: center;
            margin-bottom: 10px;
        }

        .score-board {
            font-size: 24px;
            color: var(--neon-green);
        }

        /* Mobile Controls */
        #controls {
            display: grid;
            grid-template-areas: 
                ". up ."
                "left down right";
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            width: 60px;
            height: 60px;
            background: #222;
            border: 2px solid var(--neon-green);
            color: var(--neon-green);
            font-weight: bold;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            user-select: none;
        }

        .btn:active { background: #333; }
        #up { grid-area: up; }
        #down { grid-area: down; }
        #left { grid-area: left; }
        #right { grid-area: right; }

        /* Overlay */
        #overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        #restart-btn {
            padding: 10px 20px;
            background: var(--neon-green);
            color: black;
            border: none;
            cursor: pointer;
            font-weight: bold;
            margin-top: 15px;
        }
    </style>
</head>
<body>

    <div id="ui">
        <h1>NEON SNAKE</h1>
        <div class="score-board">Score: <span id="score">0</span></div>
    </div>

    <div id="game-container">
        <canvas id="gameCanvas" width="400" height="400"></canvas>
        <div id="overlay">
            <h2 style="color: var(--neon-red);">GAME OVER</h2>
            <button id="restart-btn" onclick="resetGame()">RESTART</button>
        </div>
    </div>

    <div id="controls">
        <div class="btn" id="up" onclick="changeDirection('up')">▲</div>
        <div class="btn" id="left" onclick="changeDirection('left')">◀</div>
        <div class="btn" id="down" onclick="changeDirection('down')">▼</div>
        <div class="btn" id="right" onclick="changeDirection('right')">▶</div>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreElement = document.getElementById("score");
        const overlay = document.getElementById("overlay");

        const gridSize = 20;
        const tileCount = canvas.width / gridSize;

        let score = 0;
        let dx = 0;
        let dy = 0;
        let snake = [{x: 10, y: 10}];
        let food = {x: 5, y: 5};
        let gameSpeed = 100;

        // Initialize keyboard listeners
        document.addEventListener("keydown", handleKeydown);

        function handleKeydown(e) {
            const key = e.key;
            if (key === "ArrowUp") changeDirection('up');
            if (key === "ArrowDown") changeDirection('down');
            if (key === "ArrowLeft") changeDirection('left');
            if (key === "ArrowRight") changeDirection('right');
        }

        function changeDirection(dir) {
            if (dir === 'up' && dy === 0) { dx = 0; dy = -1; }
            if (dir === 'down' && dy === 0) { dx = 0; dy = 1; }
            if (dir === 'left' && dx === 0) { dx = -1; dy = 0; }
            if (dir === 'right' && dx === 0) { dx = 1; dy = 0; }
        }

        function main() {
            if (didGameEnd()) {
                overlay.style.display = "flex";
                return;
            }

            setTimeout(function onTick() {
                clearCanvas();
                drawFood();
                advanceSnake();
                drawSnake();
                main();
            }, gameSpeed);
        }

        function clearCanvas() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function advanceSnake() {
            // Create new head based on current velocity
            const head = { x: snake[0].x + dx, y: snake[0].y + dy };
            
            // If snake is stationary (start), don't move
            if (dx === 0 && dy === 0) return;

            snake.unshift(head);

            // Collision Logic: Food
            if (head.x === food.x && head.y === food.y) {
                score += 10;
                scoreElement.innerHTML = score;
                createFood();
            } else {
                snake.pop(); // Remove tail if no food eaten
            }
        }

        function didGameEnd() {
            if (dx === 0 && dy === 0) return false;

            // Collision Logic: Walls
            const hitLeftWall = snake[0].x < 0;
            const hitRightWall = snake[0].x > tileCount - 1;
            const hitTopWall = snake[0].y < 0;
            const hitBottomWall = snake[0].y > tileCount - 1;

            // Collision Logic: Self
            let hitSelf = false;
            for (let i = 4; i < snake.length; i++) {
                if (snake[i].x === snake[0].x && snake[i].y === snake[0].y) hitSelf = true;
            }

            return hitLeftWall || hitRightWall || hitTopWall || hitBottomWall || hitSelf;
        }

        function drawSnake() {
            ctx.fillStyle = "#39FF14";
            ctx.strokeStyle = "#000";
            snake.forEach(part => {
                ctx.fillRect(part.x * gridSize, part.y * gridSize, gridSize - 2, gridSize - 2);
                ctx.strokeRect(part.x * gridSize, part.y * gridSize, gridSize - 2, gridSize - 2);
            });
        }

        function drawFood() {
            ctx.fillStyle = "#FF3131";
            ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 2, gridSize - 2);
        }

        function createFood() {
            food.x = Math.floor(Math.random() * tileCount);
            food.y = Math.floor(Math.random() * tileCount);
            // Ensure food doesn't spawn on snake body
            snake.forEach(part => {
                if (part.x === food.x && part.y === food.y) createFood();
            });
        }

        function resetGame() {
            score = 0;
            scoreElement.innerHTML = score;
            snake = [{x: 10, y: 10}];
            dx = 0;
            dy = 0;
            overlay.style.display = "none";
            createFood();
            main();
        }

        // Start the game
        createFood();
        main();
    </script>
</body>
</html>
